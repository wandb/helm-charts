# This file is auto-generated by snapshots.sh generate-env-tests
# Do not edit manually - regenerate with: ./snapshots.sh generate-env-tests
apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "wandb.fullname" . }}-test-env-expansion"
  labels:
    {{- include "wandb.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: env-expansion-test-anchor
      image: busybox:latest
      command: &env-expansion-test-command
        - sh
        - -c
        - |
          echo "Checking for unresolved \$(VARIABLE) references in environment..."
          echo ""
          
          # Check for $(VARIABLE) style references
          FOUND=$(env | grep '(' || true)
          
          if [ -n "$FOUND" ]; then
            echo "ERROR: Found \$(VARIABLE) references in environment:"
            echo "$FOUND"
            echo ""
            echo "This typically indicates one of two issues:"
            echo "1. ConfigMap values using \$(VAR) instead of Helm templating {{"{{"}} .Values... {{"}}"}}"
            echo "2. Environment variables referencing \$(VAR) that aren't set in the pod"
            echo ""
            echo "For ConfigMaps: Use Helm templating at template-render time."
            echo "For env vars: Ensure referenced variables are defined in a _*.tpl file"
            echo "             and included via envTpls in values.yaml."
            echo ""
            exit 1
          fi
          
          echo "SUCCESS: No unresolved \$(VARIABLE) references found."
          exit 0
{{- if index .Values "app" "install" }}
    - name: app-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-api-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-glue-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-gorilla-session-key" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-frontend-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-app-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-local-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.oidcEnvs" . | indent 8 }}
{{ include "wandb.rateLimitEnvs" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "app" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "appRenamePreHook" "install" }}
    - name: apprenameprehook-env-check
      image: busybox:latest
      env:
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "appRenamePostHook" "install" }}
    - name: apprenameposthook-env-check
      image: busybox:latest
      env:
      command: *env-expansion-test-command
{{- end }}
    - name: api-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-api-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-gorilla-session-key" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.oidcEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.rateLimitEnvs" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "api" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- if index .Values "console" "install" }}
    - name: console-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-console-configmap" . }}
            optional: true
      env:
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "weave" "install" }}
    - name: weave-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-weave-configmap" . }}
            optional: true
      env:
{{ include "wandb.sslCertEnvs" . | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "weave-trace" "install" }}
    - name: weave-trace-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-weave-trace-configmap" . }}
            optional: true
      env:
{{ include "wandb.clickhouseEnvs" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "weave-trace-worker" "install" }}
    - name: weave-trace-worker-env-check
      image: busybox:latest
      envFrom:
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-weave-trace-configmap" . }}
            optional: true
      env:
{{ include "wandb.clickhouseEnvs" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "weave-trace-worker" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "weave-evaluate-model-worker" "install" }}
    - name: weave-evaluate-model-worker-env-check
      image: busybox:latest
      envFrom:
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-weave-trace-configmap" . }}
            optional: true
      env:
{{ include "wandb.clickhouseEnvs" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "weave-evaluate-model-worker" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "executor" "install" }}
    - name: executor-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-executor-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "executor" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "parquet" "install" }}
    - name: parquet-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-parquet-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "flat-run-fields-updater" "install" }}
    - name: flat-run-fields-updater-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-flat-run-fields-updater-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "flat-run-fields-updater" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "filestream" "install" }}
    - name: filestream-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-filestream-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "filestream" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "nginx" "install" }}
    - name: nginx-env-check
      image: busybox:latest
      env:
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "frontend" "install" }}
    - name: frontend-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-frontend-configmap" . }}
            optional: true
      env:
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "frontend" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "filemeta" "install" }}
    - name: filemeta-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "anaconda2" "install" }}
    - name: anaconda2-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-anaconda2-configmap" . }}
            optional: true
      env:
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "anaconda2" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
{{- if index .Values "metric-observer" "install" }}
    - name: metric-observer-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-flat-run-fields-updater-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "metric-observer" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
    - name: glue-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-redis-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-kafka-configmap" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-global-configmap" . }}
            optional: true
        - secretRef:
            name: {{ tpl "{{ .Release.Name }}-global-secret" . }}
            optional: true
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-glue-configmap" . }}
            optional: true
      env:
{{ include "wandb.downwardEnvs" . | indent 8 }}
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb.mysqlEnvs" . | indent 8 }}
{{ include "wandb.redisEnvs" . | indent 8 }}
{{ include "wandb.queueEnvs" . | indent 8 }}
{{ include "wandb.historyStoreEnvs" . | indent 8 }}
{{ include "wandb.observabilityEnvs" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.smtpEnvs" . | indent 8 }}
{{ include "wandb.license" . | indent 8 }}
{{ include "wandb.sslCertEnvs" . | indent 8 }}
      command: *env-expansion-test-command
{{- if index .Values "settingsMigrationJob" "install" }}
    - name: settingsmigrationjob-env-check
      image: busybox:latest
      envFrom:
        - configMapRef:
            name: {{ tpl "{{ .Release.Name }}-bucket-configmap" . }}
            optional: true
      env:
{{ include "wandb.bucket.cwIdentity" . | indent 8 }}
{{ include "wandb.statsigEnvs" . | indent 8 }}
{{ include "wandb.bucketEnvs" . | indent 8 }}
{{ include "wandb-base.env" (dict "env" (index .Values "settingsMigrationJob" "env") "root" .) | indent 8 }}
      command: *env-expansion-test-command
{{- end }}
  restartPolicy: Never

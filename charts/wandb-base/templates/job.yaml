{{- range $jobName, $job := .Values.jobs }}
  {{- $_ := set $job "restartPolicy" (default $job.restartPolicy "Never") }}
apiVersion: batch/v1
kind: Job
metadata:
  name: {{ printf "%s-%s" $.Release.Name $jobName }}
  labels:
    {{- include "wandb-base.labels" $ | nindent 4 }}
  {{- with $job.annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  {{- with $job.ttlSecondsAfterFinished }}
  ttlSecondsAfterFinished: {{ . }}
  {{- end }}
  {{- with $job.backoffLimit }}
  backoffLimit: {{ . }}
  {{- end }}
  template:
    {{- include "wandb-base.pod" (dict "podData" $job "root" $) | nindent 4 }}
---
{{- end }}
